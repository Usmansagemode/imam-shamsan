# Developer Setup Guide — Notion CMS & Cloudinary

This guide covers how to set up the 6 Notion databases and Cloudinary as the content management layer for the Imam Shamsan portfolio website. The website pulls content from Notion (text, metadata) and Cloudinary (images) at runtime via API.

---

## Table of Contents

1. [Notion Workspace Setup](#1-notion-workspace-setup)
2. [Notion Database Schemas](#2-notion-database-schemas)
3. [Cloudinary Setup](#3-cloudinary-setup)
4. [Environment Variables](#4-environment-variables)
5. [Block-Level Content (Mixed Arabic/English)](#5-block-level-content-mixed-arabicenglish)
6. [Data Flow](#6-data-flow)

---

## 1. Notion Workspace Setup

### Create the Integration

1. Go to [https://www.notion.so/my-integrations](https://www.notion.so/my-integrations)
2. Click **"New integration"**
3. Name it `Imam Shamsan Website`
4. Select the client's workspace
5. Set capabilities:
   - **Content**: Read content
   - **Comments**: No access
   - **User information**: No access
6. Copy the **Internal Integration Token** — this becomes `NOTION_API_KEY`

### Share Databases with the Integration

Each of the 6 databases must be explicitly shared with the integration:
- Open the database page in Notion
- Click **"..."** (top right) > **"Connections"** > search for your integration name > **"Confirm"**

### Get Database IDs

From each database's URL: `https://notion.so/{workspace}/{DATABASE_ID}?v=...`

Copy the DATABASE_ID portion for your `.env` file.

---

## 2. Notion Database Schemas

Create each database as a **full-page database** in Notion. Property names must match **exactly** — the code queries by these names.

---

### Database 1: Articles

> The primary CMS for blog posts/writings. Body content lives in the **Notion page body** (block content), not in properties.

| Property Name     | Type             | Purpose                                              |
|-------------------|------------------|------------------------------------------------------|
| Title             | Title            | Article name (Notion's default title column)          |
| Slug              | Rich text        | URL-friendly identifier (e.g., `patience-in-islam`)   |
| Description       | Rich text        | Excerpt/summary shown in article cards                |
| Cover Image       | URL              | Cloudinary URL for the cover image                    |
| Language          | Select           | Options: `English`, `Arabic`, `Bilingual`             |
| Category          | Select           | Options: `Islamic Knowledge`, `Quran/Hadith Commentary`, `Ramadan/Eid`, `Personal Reflections`, `Islamic History` |
| Tags              | Multi-select     | Flexible tagging (e.g., Faith, Family, Youth)         |
| Status            | Select           | Options: `Draft`, `Published`                         |
| Featured          | Checkbox         | Show on homepage                                      |
| Created time      | Created time     | Auto-generated by Notion                              |
| Last edited time  | Last edited time | Auto-generated by Notion                              |

**Body content:** The imam writes directly in the page body — paragraphs, headings, lists, quotes, callouts, images (Cloudinary URLs via Embed link).

**How the code uses it:**
- Filters by `Status = Published`
- Sorts by `Created time` descending
- For article detail pages, fetches all child blocks for the full body
- `Language` determines RTL rendering (`Arabic` → `dir="rtl"` + Scheherazade New font)

**Env variable:** `NOTION_ARTICLES_DATABASE_ID`

---

### Database 2: Services

> Booking cards with pricing. No page body content needed — everything is in properties.

| Property Name   | Type        | Purpose                                             |
|-----------------|-------------|-----------------------------------------------------|
| Name EN         | Title       | English service name (Notion's default title column) |
| Name AR         | Rich text   | Arabic service name                                  |
| Description     | Rich text   | Brief description of the service                     |
| Price Display   | Rich text   | e.g., `$300` or `$300-$500` or `Contact for details` |
| Price Note      | Rich text   | Additional pricing info (e.g., "based on distance")  |
| Icon            | Rich text   | Icon identifier (for future use)                     |
| Order           | Number      | Display order (lower numbers first)                  |
| Status          | Select      | Options: `Active`, `Inactive`                        |

**How the code uses it:**
- Filters by `Status = Active`
- Sorts by `Order` ascending
- Each card links to `/contact?service={slug}` (pre-fills the contact form)

**Env variable:** `NOTION_SERVICES_DATABASE_ID`

---

### Database 3: Sermon Summaries

> Written summaries of Friday khutbahs. Body content lives in the **Notion page body**.

| Property Name   | Type         | Purpose                                       |
|-----------------|--------------|-----------------------------------------------|
| Title           | Title        | Sermon title (Notion's default title column)   |
| Slug            | Rich text    | URL-friendly identifier                        |
| Description     | Rich text    | Short summary for listing cards                |
| YouTube Link    | URL          | Link to the video recording                    |
| Date            | Date         | Date the sermon was delivered                  |
| Status          | Select       | Options: `Draft`, `Published`                  |
| Created time    | Created time | Auto-generated by Notion                       |

**Body content:** The imam writes the full sermon summary in the page body (mixed Arabic/English).

**How the code uses it:**
- Filters by `Status = Published`
- Sorts by `Date` descending
- For detail pages, embeds the YouTube video + renders the written summary from page blocks

**Env variable:** `NOTION_SERMONS_DATABASE_ID`

---

### Database 4: Gallery

> Individual photos for the gallery page. No page body content — one entry per image.

| Property Name | Type       | Purpose                                              |
|---------------|------------|------------------------------------------------------|
| Caption       | Title      | Photo caption (Notion's default title column)         |
| Image URL     | URL        | Direct Cloudinary URL for the photo                   |
| Category      | Select     | Options: `Events`, `Conferences`, `Community`, `Scholars`, `Programs`, `Flyers` |
| Order         | Number     | Display order within a category                       |
| Featured      | Checkbox   | Highlight on homepage or top of gallery               |
| Status        | Select     | Options: `Active`, `Inactive`                         |

**How the code uses it:**
- Filters by `Status = Active`
- Sorts by `Order` ascending
- Frontend filters by `Category`
- Clicking opens a full-screen lightbox

**Env variable:** `NOTION_GALLERY_DATABASE_ID`

---

### Database 5: Recitations

> Qur'anic recitation videos displayed on the Media page. Each entry is one YouTube video. To remove a recitation, simply delete the row.

| Property Name | Type   | Purpose                                    |
|---------------|--------|--------------------------------------------|
| Title         | Title  | Recitation name (e.g., "Surah Al-Mulk")    |
| YouTube Link  | URL    | YouTube video link                          |
| Order         | Number | Display order (lower numbers first)         |

**How the code uses it:**
- Fetches all entries
- Sorts by `Order` ascending
- Embeds each video on the Media page in a 2-column grid

**Env variable:** `NOTION_RECITATIONS_DATABASE_ID`

---

### Database 6: Site Settings

> Key-value configuration. Lets the imam update things like the live stream URL without code changes.

| Property Name     | Type             | Purpose                  |
|-------------------|------------------|--------------------------|
| Key               | Title            | Setting name             |
| Value             | Rich text        | Setting value            |
| Last edited time  | Last edited time | Auto-generated by Notion |

**Initial entries to create:**

| Key                | Example Value                                      |
|--------------------|----------------------------------------------------|
| live_stream_url    | `https://www.youtube.com/watch?v=xxxxx`            |
| live_stream_title  | `Friday Khutbah - Week of Feb 14`                  |
| profile_img        | `https://res.cloudinary.com/.../profile.jpg`       |
| logo               | `https://res.cloudinary.com/.../logo.jpg`          |

The imam updates these weekly. The homepage uses the `Last edited time` of the `live_stream_url` row to show live status:
- **Updated today** → pulsing red "LIVE" badge appears
- **Updated in the past** → shows "2 days ago" / "1 week ago"
- **No URL set** → falls back to generic "Media" heading

**Env variable:** `NOTION_SETTINGS_DATABASE_ID`

---

## 3. Cloudinary Setup

### What Cloudinary Does

Cloudinary hosts all images permanently. The code transforms Cloudinary URLs on-the-fly for optimization (resizing, format conversion, quality) — no Cloudinary API key or SDK is needed.

### Account Setup

1. Create a free Cloudinary account (or use the client's)
2. Note the **Cloud Name** from the Dashboard — this is the only value needed
3. No API Key or API Secret required (we only do URL transformations, not API calls)

### How the Imam Uploads Images

1. Log in to Cloudinary
2. Click **Upload** and drop the image(s)
3. Copy the URL (right-click the image > Copy URL)
4. Paste the URL in Notion:
   - **For article inline images:** In the page body, type `/image` > choose **"Embed link"** > paste the Cloudinary URL
   - **For cover images / gallery:** Paste the URL directly into the `Cover Image` or `Image URL` property

**Important:** The imam must always use **"Embed link"** (not "Upload") when adding images in Notion page bodies. Notion-hosted images expire after 1 hour. Cloudinary URLs are permanent.

### Folder Structure (Optional)

No folder structure is required. The code works with any valid Cloudinary URL regardless of where the file is stored. The imam can organize folders however they prefer for their own convenience.

---

## 4. Environment Variables

Add these to `.env` locally or in Vercel project settings:

```env
# Site
SITE_URL=https://imamshamsan.com

# Notion
NOTION_API_KEY=secret_xxxxxxxxxxxxxxxxxxxxxxxx
NOTION_ARTICLES_DATABASE_ID=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
NOTION_SERVICES_DATABASE_ID=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
NOTION_SERMONS_DATABASE_ID=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
NOTION_GALLERY_DATABASE_ID=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
NOTION_RECITATIONS_DATABASE_ID=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
NOTION_SETTINGS_DATABASE_ID=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# Cloudinary (cloud name only — no API key needed)
CLOUDINARY_CLOUD_NAME=xxxxxxxxx

# Email
CONTACT_EMAIL=MCCGPImamShamsan@gmail.com
RESEND_API_KEY=re_xxxxxxxxxxxxxxxxxxxxxxxx
```

### Vercel Environment Variables

1. Go to Vercel project > **Settings** > **Environment Variables**
2. Add each variable above for **Production**, **Preview**, and **Development**
3. Redeploy after adding variables

---

## 5. Block-Level Content (Mixed Arabic/English)

All sermon summaries and articles may contain **mixed Arabic and English** text within the same page.

### How It Works

When the imam writes in a Notion page body, Notion stores it as an ordered array of **blocks**:

```
Block 1: heading_2   →  "خطبة الجمعة - The Friday Sermon"
Block 2: paragraph   →  "بسم الله الرحمن الرحيم"
Block 3: paragraph   →  "Today we reflect on the importance of..."
Block 4: image       →  { type: "external", url: "https://res.cloudinary.com/..." }
Block 5: quote       →  "Indeed, with hardship comes ease. (94:6)"
```

### How the Code Renders It

- The code fetches all child blocks recursively via the Notion API (`src/lib/notion.ts`)
- Each block is parsed into a `ContentBlock` type (`src/lib/parsers.ts`)
- The `ArticleContent` component (`src/components/articles/ArticleContent.tsx`) renders each block as the appropriate HTML element
- **Articles with `Language: Arabic`** get `dir="rtl"` + Scheherazade New font on the entire article
- **Bilingual articles** use `dir="auto"` so the browser detects direction per-paragraph

### Fonts

- **English text:** Montserrat (weights: 400, 500, 600, 700)
- **Arabic text:** Scheherazade New (weights: 400, 500, 600, 700)

Both are loaded from Google Fonts in `src/styles.css`.

### Notion-Hosted Images Expire

If the imam drags an image directly into Notion (upload), Notion stores it with a **signed URL that expires after 1 hour**:

- Site loads at 2:00 PM → image works
- Visitor at 4:00 PM → **broken image**

**The solution:** Always use **"Embed link"** and paste a **Cloudinary URL**. The code handles both types but only Cloudinary URLs are permanent.

---

## 6. Data Flow

```
Imam uploads images to Cloudinary → copies URL
        |
        v
Imam writes in Notion (text + Cloudinary image embeds)
        |
        v
Website queries Notion API (Status = Published / Active)
        |
        v
For articles/sermons: fetches page blocks (paragraphs, headings, images, lists)
For services/gallery/recitations/settings: reads properties directly
        |
        v
Images rendered via Cloudinary URL transformations (auto format, quality, resize)
        |
        v
Arabic content rendered with Scheherazade New font + RTL direction
```

The imam manages content through two interfaces:
- **Notion** — all text content, metadata, publish controls, inline image embeds
- **Cloudinary** — uploading photos, then pasting URLs into Notion
